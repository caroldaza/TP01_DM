---
title: "R Notebook"
output: html_notebook
---
*Imports*

```{r}
library(mongolite)
library(modeest)
```

*Carga datasets*

```{r}
artistas = mongo(db = "DMUBA_SPOTIFY", collection = 'artist')
artist <- artistas$find('{}')

chart = mongo(db = "DMUBA_SPOTIFY", collection = 'charts')
charts <- chart$find('{}')

#artista_audio_features = mongo(db = "DMUBA_SPOTIFY", collection = 'artist_audio_features')
#artist_audio_features <- artista_audio_features$find('{}')
```

*Atributos*

Artista:

```{r}
# Nombres columnas
names(artist)
# Tamaño dataframe
dim(artist)
```
```{r}
aux <- unique(artist)
head(aux,5)
```
No hay artistas repetidos en Artist:
```{r}
dim(aux)
```
No hay missings en Artist
```{r}
colSums(is.na(artist))  
```

Charts

```{r}
# Nombres columnas
names(charts)
# Tamaño dataframe
dim(charts)
```
*Summary*

Streams

```{r}
summary(charts$Streams)
```
Cantidad de datos por año

```{r}
date <- format(as.Date(charts$week_start, format="%Y-%m-%d"),"%Y")
table(date)
```
Cantidad de tracks por artista

```{r}
trackxartist <- aggregate(Track_Name ~Artist, data=charts, FUN=length)
trackxartist<-trackxartist[order(-trackxartist$Track_Name),]
trackxartist
```
```{r}
summary(trackxartist)
```
```{r}
hist(trackxartist$Track_Name, xlab = "Tracks", ylab = "Freq", 
        main="Cantidad de tracks por artista",breaks=100) 
```

No hay missings en charts
```{r}
colSums(is.na(charts))  
```
```{r}
dim(trackxartist)
```
pero hay un artista mas en esta tabla... es una fila de un track que aparece cuatro veces sin artista...

Cantidad media de streams por artista (totales, se podria hacer por año)

```{r}
streamsxartist <- aggregate(Streams ~charts$Artist, data=charts, FUN=mean)
streamsxartist<-streamsxartist[order(-streamsxartist$Streams),]
streamsxartist
```

```{r}
summary(streamsxartist)
```

```{r}
hist(streamsxartist$Streams, xlab = "streams", ylab = "Freq", 
        main="Cantidad de reproducciones", breaks=50) 
```
Canciones top

Hay 36 canciones que han ocupado el primer lugar (total, tambien se puede discriminar por año)
```{r}
tabla <- charts[charts$Position == 1,] 
top <- unique(tabla$Track_Name)
length(top)
print(top)
```
Artistas con mas canciones top (hay que reescribir esta query a mongolite) (se puede discriminar por año)
```{r}
db.charts.aggregate( [
    {$match : {Position:1} },
    {$group: {"_id": {"Artista":"$Artist", "Track":"$Track_Name"}, 
    "veces_top": {$sum: 1} } },
    {$sort:{"veces_top":-1} },
  ] )

```



